[build]
  publish = "_site/"
  command = "bundle exec jekyll build"

[context.production.environment]
  JEKYLL_ENV = "production"

# JEKYLL_ENV defaults to development so commenting out
#[context.branch-deploy.environment]
#  JEKYLL_ENV = "development"

# Config for the Netlify Build Plugin: netlify-plugin-minify-html
[[plugins]]
  package = "netlify-plugin-minify-html"
  [plugins.inputs]
    contexts = [
      'production',
      'branch-deploy',
      'deploy-preview'
    ]
  # Optionally, override the default options for the minification
  # https://github.com/kangax/html-minifier#options-quick-reference
  [plugins.inputs.minifierOptions]
    collapseBooleanAttributes=true
    collapseWhitespace=true
    conservativeCollapse=true
    decodeEntities=true
    includeAutoGeneratedTags=false
    minifyCSS=true
    minifyJS=true
    preserveLineBreaks=true
    removeAttributeQuotes=true
    removeComments=true
    removeOptionalTags=true
    removeRedundantAttributes=true
    removeScriptTypeAttributes=true
    removeStyleLinkTypeAttributes=true
    trimCustomFragments=true
    useShortDoctype=true

[[plugins]]
  package = "netlify-plugin-jekyll-cache"
  [plugins.inputs]
    # This is only required if you have defined a source directory in Jekyll
    # At some point this will become automated, but for now it must be specified 
    # jekyllSource = "/jekyll"

# Gone AWOL
[[redirects]]
  from = "/privacy"
  to = "/"
  status = 410    # GONE
  force = true

[[redirects]]
  from = "/projects"
  to = "/"
  status = 410    # GONE
  force = true

[[redirects]]
  from = "/projects"
  to = "/"
  status = 410    # GONE
  force = true

[[redirects]]
  from = "/tag/*"
  to = "/"
  status = 410    # GONE
  force = true

[[redirects]]
  from = "/admin"
  to = "/"
  status = 410    # GONE
  force = true

[[redirects]]
  from = "/page*"
  to = "/archives"

[[headers]]
  for = "/*"
  [headers.values]
    Permissions-Policy = "interest-cohort=()"

[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=2629000"

[[headers]]
  for = "*.svg"
  [headers.values]
    Content-Type = "image/svg+xml, charset=utf-8"

[[headers]]
  for = "/img/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000"

[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=2629000"
